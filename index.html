<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>guns.lol Logo Styler with Color Replace & GIF Glow</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f0f0f;
      color: white;
      text-align: center;
    }
    .container {
      padding: 2em;
      max-width: 600px;
      margin: auto;
    }
    .white-button {
      background-color: white;
      color: black;
      border: none;
      padding: 1em 2em;
      margin-top: 1em;
      font-weight: bold;
      cursor: pointer;
      border-radius: 10px;
      box-shadow: 0 0 10px white, 0 0 20px white;
      transition: 0.3s;
    }
    .white-button:hover {
      transform: scale(1.05);
    }
    .preview {
      margin-top: 2em;
    }
    canvas {
      background: transparent;
      max-width: 100%;
      height: auto;
    }
    input[type="color"] {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>guns.lol Logo Styler with Color Replace & GIF Glow</h1>

    <input type="file" id="logoUpload" accept="image/*" /><br /><br />

    <label><input type="checkbox" id="toggleGlow" checked /> Enable Glow</label><br /><br />
    <label>Glow Color: <input type="color" id="colorPicker" value="#ffffff" /></label><br /><br />

    <label><input type="checkbox" id="enableColorReplace" checked /> Enable Color Replace</label><br /><br />
    <label>Target Color to Replace: <input type="color" id="targetColor" value="#0000ff" /></label><br /><br />
    <label>Replacement Color: <input type="color" id="replacementColor" value="#ff0000" /></label><br /><br />

    <button id="saveBtn" class="white-button">Save as Image</button>

    <div class="preview">
      <canvas id="canvas"></canvas>
    </div>
  </div>

  <!-- GIF animation library -->
  <script src="https://cdn.jsdelivr.net/npm/gifler@0.1.0/gifler.min.js"></script>

  <script>
    const fileInput = document.getElementById("logoUpload");
    const colorPicker = document.getElementById("colorPicker");
    const toggleGlow = document.getElementById("toggleGlow");
    const enableColorReplace = document.getElementById("enableColorReplace");
    const targetColorPicker = document.getElementById("targetColor");
    const replacementColorPicker = document.getElementById("replacementColor");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const saveBtn = document.getElementById("saveBtn");

    let img = new Image();
    let glowColor = "#ffffff";
    let pulse = 0;
    let direction = 1;
    let glowEnabled = true;
    let colorReplaceEnabled = true;

    let isGif = false;
    let gifInstance = null;

    img.crossOrigin = "anonymous";
    // Default image (your link)
    img.src = "https://raw.githubusercontent.com/trxpvoidz/assets-for-my-website/refs/heads/main/IMG_1867.jpeg?token=GHSAT0AAAAAADGWR4O3NYL5PKUPQ7DGXWEY2EQJAWQ";

    img.onload = () => {
      setupCanvas(img.width, img.height);
      startAnimation();
    };

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      isGif = file.type === "image/gif";

      const reader = new FileReader();
      reader.onload = () => {
        if (isGif) {
          if (gifInstance) {
            gifInstance.stop();
            gifInstance = null;
          }
          setupCanvas(null, null); // will reset size after GIF loads
          gifler(reader.result).get((anim) => {
            gifInstance = anim;
            canvas.width = anim.width + 100;
            canvas.height = anim.height + 100;
            anim.animateInCanvas(canvas);
            startAnimation();
          });
        } else {
          if (gifInstance) {
            gifInstance.stop();
            gifInstance = null;
          }
          img.src = reader.result;
        }
      };
      reader.readAsDataURL(file);
    });

    colorPicker.addEventListener("input", (e) => {
      glowColor = e.target.value;
    });
    toggleGlow.addEventListener("change", () => {
      glowEnabled = toggleGlow.checked;
    });
    enableColorReplace.addEventListener("change", () => {
      colorReplaceEnabled = enableColorReplace.checked;
      if (!isGif) drawImageWithColorReplace();
    });
    targetColorPicker.addEventListener("input", () => {
      if (colorReplaceEnabled && !isGif) drawImageWithColorReplace();
    });
    replacementColorPicker.addEventListener("input", () => {
      if (colorReplaceEnabled && !isGif) drawImageWithColorReplace();
    });

    function setupCanvas(width, height) {
      if (width && height) {
        canvas.width = width + 100;
        canvas.height = height + 100;
      }
    }

    function startAnimation() {
      if (isGif) {
        animateGifGlow();
      } else {
        animateGlow();
      }
    }

    function animateGlow() {
      requestAnimationFrame(animateGlow);
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (glowEnabled) {
        ctx.shadowColor = glowColor;
        ctx.shadowBlur = 30 + pulse;
      } else {
        ctx.shadowColor = "transparent";
        ctx.shadowBlur = 0;
      }

      drawImageWithColorReplace();

      if (glowEnabled) {
        pulse += direction;
        if (pulse > 20 || pulse < 0) direction *= -1;
      }
    }

    function animateGifGlow() {
      requestAnimationFrame(animateGifGlow);
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (gifInstance && gifInstance.canvas) {
        let frameCanvas = gifInstance.canvas;
        if (!frameCanvas) return;

        if (glowEnabled) {
          ctx.shadowColor = glowColor;
          ctx.shadowBlur = 30 + pulse;
        } else {
          ctx.shadowColor = "transparent";
          ctx.shadowBlur = 0;
        }

        ctx.drawImage(frameCanvas, 50, 50);

        if (glowEnabled) {
          pulse += direction;
          if (pulse > 20 || pulse < 0) direction *= -1;
        }
      }
    }

    function drawImageWithColorReplace() {
      if (!img.complete) return;

      if (!colorReplaceEnabled) {
        ctx.drawImage(img, 50, 50);
        return;
      }

      const offCanvas = document.createElement("canvas");
      const offCtx = offCanvas.getContext("2d");
      offCanvas.width = img.width;
      offCanvas.height = img.height;
      offCtx.clearRect(0, 0, offCanvas.width, offCanvas.height);
      offCtx.drawImage(img, 0, 0);

      let imageData = offCtx.getImageData(0, 0, offCanvas.width, offCanvas.height);
      let data = imageData.data;

      let targetRgb = hexToRgb(targetColorPicker.value);
      let replacementRgb = hexToRgb(replacementColorPicker.value);

      const threshold = 100;

      for (let i = 0; i < data.length; i += 4) {
        let r = data[i];
        let g = data[i + 1];
        let b = data[i + 2];
        let a = data[i + 3];
        if (a === 0) continue;

        let dist = colorDistance({ r, g, b }, targetRgb);
        if (dist < threshold) {
          data[i] = replacementRgb.r;
          data[i + 1] = replacementRgb.g;
          data[i + 2] = replacementRgb.b;
        }
      }

      offCtx.putImageData(imageData, 0, 0);

      ctx.drawImage(offCanvas, 50, 50);
    }

    function hexToRgb(hex) {
      let bigint = parseInt(hex.slice(1), 16);
      let r = (bigint >> 16) & 255;
      let g = (bigint >> 8) & 255;
      let b = bigint & 255;
      return { r, g, b };
    }

    function colorDistance(c1, c2) {
      return Math.sqrt(
        (c1.r - c2.r) ** 2 +
          (c1.g - c2.g) ** 2 +
          (c1.b - c2.b) ** 2
      );
    }

    saveBtn.addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "styled-logo.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });
  </script>
</body>
</html>
